#!/bin/bash
set -e

# Remove a potentially pre-existing server.pid for Rails.
rm -f /app/tmp/pids/server.pid

# Railsã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
echo "ğŸ” Checking for Gemfile changes..."
bundle check || bundle install

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™
if [ "${1}" = "./bin/rails" ] || [ "${1}" = "rails" ] || [ "${1}" = "bin/rails" ]; then
  echo "ğŸ”§ Preparing database..."
  bundle exec rails db:prepare
fi

# ãã®ä»–ã®ç’°å¢ƒè¨­å®š
export RAILS_ENV=${RAILS_ENV:-"development"}
export RAILS_SERVE_STATIC_FILES=${RAILS_SERVE_STATIC_FILES:-"true"}

echo "ğŸš€ Starting application..."
exec "$@"

# # Enable jemalloc for reduced memory usage and latency.
# if [ -z "${LD_PRELOAD+x}" ]; then
#     LD_PRELOAD=$(find /usr/lib -name libjemalloc.so.2 -print -quit)
#     export LD_PRELOAD
# fi

# # If running the rails server then create or migrate existing database
# if [ "${@: -2:1}" == "./bin/rails" ] && [ "${@: -1:1}" == "server" ]; then
#   ./bin/rails db:prepare
# fi

# exec "${@)"
